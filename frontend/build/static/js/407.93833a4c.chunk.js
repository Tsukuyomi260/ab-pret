"use strict";(self.webpackChunkab_campus_finance_frontend=self.webpackChunkab_campus_finance_frontend||[]).push([[407],{9407:(e,t,a)=>{a.r(t),a.d(t,{default:()=>O});var s=a(5043),r=a(3216),n=a(6540),l=a(5099),d=a(7607),o=a(6852),i=a(2938),c=a(917),m=a(5722),x=a(9120),g=a(4068),u=a(6487),p=a(5275),h=a(1327),b=a(6150),f=a(108),j=a(7869),y=a(4240),v=a(7734),N=a(3839),w=a(8643),D=a(2185),S=a(6026),k=a(2291),_=a(163),I=a(877),C=a(6047),M=a(579);const P=[{id:"day",label:"Aujourd'hui"},{id:"week",label:"Cette semaine"},{id:"month",label:"Ce mois"},{id:"quarter",label:"Ce trimestre"},{id:"year",label:"Cette ann\xe9e"}];function A(e,t,a){const s=new Date(e);return s>=t&&s<=a}const z=e=>e.toISOString().slice(0,10),O=()=>{const e=(0,r.Zp)(),[t,a]=(0,s.useState)("month"),[O,R]=(0,s.useState)(!0),[F,E]=(0,s.useState)([]),[H,K]=(0,s.useState)([]),T=(0,s.useMemo)(()=>new Date,[]),[q,V]=(0,s.useState)(()=>{const e=new Date(T);return e.setMonth(e.getMonth()-1),z(e)}),[B,G]=(0,s.useState)(()=>z(T)),W=(0,s.useMemo)(()=>{if("custom"===t&&q&&B){const e=new Date(q);e.setHours(0,0,0,0);const t=new Date(B);return t.setHours(23,59,59,999),{start:e,end:t}}return function(e){const t=new Date,a=new Date(t);a.setHours(23,59,59,999);let s=new Date(t);switch(e){case"day":s.setHours(0,0,0,0);break;case"week":s.setDate(s.getDate()-6),s.setHours(0,0,0,0);break;case"month":s.setDate(1),s.setHours(0,0,0,0);break;case"quarter":const e=Math.floor(t.getMonth()/3)+1;s.setMonth(3*(e-1),1),s.setHours(0,0,0,0);break;case"year":s.setMonth(0,1),s.setHours(0,0,0,0);break;default:s.setMonth(s.getMonth()-1)}return{start:s,end:a}}(t)},[t,q,B]);(0,s.useEffect)(()=>{let e=!1;return async function(){R(!0);try{const[t,a]=await Promise.all([(0,n.Or)(),(0,n.k5)()]);e||(E(t.success&&t.data||[]),K(a.success&&a.data||[]))}finally{e||R(!1)}}(),()=>{e=!0}},[]);const Y=(0,s.useMemo)(()=>{const{start:e,end:a}=W,s=F.filter(e=>"completed"===e.status&&e.approved_at),r=F.filter(t=>A(t.created_at,e,a)),n=F.filter(t=>t.approved_at&&A(t.approved_at,e,a)),l=H.filter(t=>A(t.payment_date||t.created_at,e,a)).reduce((e,t)=>e+(t.amount||0),0),d=n.reduce((e,t)=>e+(t.amount||0),0),o=n.reduce((e,t)=>e+Math.round((t.amount||0)*((t.interest_rate||0)/100)),0),i=s.filter(t=>{const s=H.filter(e=>e.loan_id===t.id),r=s.length?Math.max(...s.map(e=>new Date(e.payment_date||e.created_at).getTime())):new Date(t.updated_at||t.approved_at).getTime();return r>=e.getTime()&&r<=a.getTime()}).reduce((e,t)=>e+Math.round((t.amount||0)*((t.interest_rate||0)/100)),0),c=F.filter(e=>e.approved_at&&"pending"!==e.status&&"rejected"!==e.status).reduce((e,t)=>e+(t.amount||0),0),m=H.reduce((e,t)=>e+(t.amount||0),0),x=c>0?Math.round(m/c*100):0;return{loansCreatedInPeriod:r.length,loansValidatedInPeriod:n.length,principalValidatedInPeriod:d,interestCollectedInPeriod:i,totalPaidInPeriod:l,interestValidatedInPeriod:o,repaymentRate:x,byDay:L(r,e,a,"custom"===t?"day":t),byStatus:J(F),interestByMonth:Q(F,H)}},[F,H,W,t]);function L(e,t,a,s){if("year"===s){const a={};for(let e=0;e<12;e++){const s="".concat(t.getFullYear(),"-").concat(String(e+1).padStart(2,"0"));a[s]={date:s,demandes:0,label:new Date(t.getFullYear(),e,1).toLocaleDateString("fr-FR",{month:"short",year:"2-digit"})}}return e.forEach(e=>{const t=new Date(e.created_at).toISOString().slice(0,7);a[t]&&(a[t].demandes+=1)}),Object.values(a).sort((e,t)=>e.date.localeCompare(t.date))}if("quarter"===s){const s={},r=new Date(t);for(;r<=a;){const e=new Date(r);e.setDate(r.getDate()-r.getDay());const t=e.toISOString().slice(0,10);s[t]||(s[t]={date:t,demandes:0,label:"S. ".concat(e.getMonth()+1,"/").concat(String(e.getDate()).padStart(2,"0"))}),r.setDate(r.getDate()+1)}return e.forEach(e=>{const t=new Date(e.created_at),a=new Date(t);a.setDate(t.getDate()-t.getDay());const r=a.toISOString().slice(0,10);s[r]&&(s[r].demandes+=1)}),Object.values(s).sort((e,t)=>e.date.localeCompare(t.date))}const r={},n=new Date(t);for(;n<=a;){const e=n.toISOString().slice(0,10);r[e]={date:e,demandes:0,label:n.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})},n.setDate(n.getDate()+1)}return e.forEach(e=>{const t=new Date(e.created_at).toISOString().slice(0,10);r[t]&&(r[t].demandes+=1)}),Object.values(r).sort((e,t)=>e.date.localeCompare(t.date))}function J(e){const t={pending:0,active:0,approved:0,overdue:0,completed:0,rejected:0};return e.forEach(e=>{const a=e.status||"pending";void 0!==t[a]&&(t[a]+=1)}),[{name:"En attente",value:t.pending,color:"#eab308"},{name:"Actifs",value:t.active+t.approved+t.overdue,color:"#3b82f6"},{name:"Rembours\xe9s",value:t.completed,color:"#22c55e"},{name:"Rejet\xe9s",value:t.rejected,color:"#ef4444"}].filter(e=>e.value>0)}function Q(e,t){const a=e.filter(e=>"completed"===e.status&&e.approved_at),s={};return a.forEach(e=>{const a=t.filter(t=>t.loan_id===e.id),r=a.length?new Date(Math.max(...a.map(e=>new Date(e.payment_date||e.created_at).getTime()))):new Date(e.updated_at||e.approved_at),n="".concat(r.getFullYear(),"-").concat(String(r.getMonth()+1).padStart(2,"0")),l=Math.round((e.amount||0)*((e.interest_rate||0)/100));s[n]=(s[n]||0)+l}),Object.entries(s).map(e=>{let[t,a]=e;return{month:t,value:a,label:t}}).sort((e,t)=>e.month.localeCompare(t.month)).slice(-12)}return(0,M.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50/30 pb-24",children:[(0,M.jsx)("div",{className:"bg-white/80 backdrop-blur-lg shadow-sm border-b border-gray-100 sticky top-0 z-30",children:(0,M.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,M.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,M.jsxs)("div",{className:"flex items-center gap-3",children:[(0,M.jsx)("button",{type:"button",onClick:()=>e("/admin/analytics"),className:"p-2 rounded-xl bg-green-100 text-green-700 hover:bg-green-200 transition-colors","aria-label":"Retour",children:(0,M.jsx)(d.A,{size:20})}),(0,M.jsx)("div",{className:"p-2.5 bg-green-100 rounded-xl",children:(0,M.jsx)(o.A,{size:24,className:"text-green-600"})}),(0,M.jsxs)("div",{children:[(0,M.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 font-montserrat",children:"Statistiques d\xe9taill\xe9es"}),(0,M.jsx)("p",{className:"text-sm text-gray-500",children:"Graphiques et filtres par p\xe9riode"})]})]}),(0,M.jsxs)("button",{type:"button",onClick:()=>window.location.reload(),className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-xl text-gray-700 hover:bg-gray-50 transition-colors shadow-sm",children:[(0,M.jsx)(g.A,{size:18}),(0,M.jsx)("span",{className:"hidden sm:inline text-sm font-medium",children:"Actualiser"})]})]})})}),(0,M.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:O?(0,M.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 gap-4",children:[(0,M.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-2 border-green-500 border-t-transparent"}),(0,M.jsx)("p",{className:"text-gray-500 text-sm",children:"Chargement des donn\xe9es..."})]}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)("div",{className:"mb-6",children:[(0,M.jsxs)("p",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[(0,M.jsx)(i.A,{size:16,className:"text-green-600"}),"P\xe9riode"]}),(0,M.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:P.map(e=>(0,M.jsx)("button",{type:"button",onClick:()=>a(e.id),className:"px-4 py-2.5 rounded-xl text-sm font-medium transition-all ".concat(t===e.id&&"custom"!==t?"bg-green-500 text-white shadow-md":"bg-white text-gray-600 border border-gray-200 hover:bg-green-50 hover:border-green-200"),children:e.label},e.id))}),(0,M.jsxs)("div",{className:"flex flex-wrap items-center gap-3 p-4 bg-white rounded-2xl border border-gray-100 shadow-sm",children:[(0,M.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,M.jsx)(i.A,{size:20,className:"text-green-600 flex-shrink-0"}),(0,M.jsx)("span",{className:"text-sm font-medium",children:"Dates personnalis\xe9es"})]}),(0,M.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[(0,M.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,M.jsx)("span",{className:"text-gray-500 whitespace-nowrap",children:"Du"}),(0,M.jsx)("input",{type:"date",value:q,onChange:e=>{V(e.target.value),a("custom"),e.target.value>B&&G(e.target.value)},className:"px-3 py-2 rounded-xl border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-500/20 outline-none text-gray-900"})]}),(0,M.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,M.jsx)("span",{className:"text-gray-500 whitespace-nowrap",children:"au"}),(0,M.jsx)("input",{type:"date",value:B,min:q,onChange:e=>{G(e.target.value),a("custom"),e.target.value<q&&V(e.target.value)},className:"px-3 py-2 rounded-xl border border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-500/20 outline-none text-gray-900"})]}),"custom"===t&&(0,M.jsx)("span",{className:"text-xs text-green-600 font-medium bg-green-50 px-2 py-1 rounded-lg",children:"Personnalis\xe9"})]})]})]}),(0,M.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-4 sm:p-5 shadow-lg border border-gray-100",children:[(0,M.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,M.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,M.jsx)(m.A,{size:18,className:"text-blue-600"})}),(0,M.jsx)("span",{className:"text-xs font-medium text-gray-500",children:"Demandes re\xe7ues"})]}),(0,M.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:Y.loansCreatedInPeriod})]}),(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-4 sm:p-5 shadow-lg border border-gray-100",children:[(0,M.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,M.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,M.jsx)(c.A,{size:18,className:"text-green-600"})}),(0,M.jsx)("span",{className:"text-xs font-medium text-gray-500",children:"Pr\xeats valid\xe9s"})]}),(0,M.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:Y.loansValidatedInPeriod})]}),(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-4 sm:p-5 shadow-lg border border-gray-100",children:[(0,M.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,M.jsx)("div",{className:"p-2 bg-emerald-100 rounded-lg",children:(0,M.jsx)(x.A,{size:18,className:"text-emerald-600"})}),(0,M.jsx)("span",{className:"text-xs font-medium text-gray-500",children:"Int\xe9r\xeats collect\xe9s (p\xe9riode)"})]}),(0,M.jsx)("p",{className:"text-lg font-bold text-gray-900",children:(0,C.vv)(Y.interestCollectedInPeriod)})]}),(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-4 sm:p-5 shadow-lg border border-gray-100",children:[(0,M.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,M.jsx)("div",{className:"p-2 bg-amber-100 rounded-lg",children:(0,M.jsx)(u.A,{size:18,className:"text-amber-600"})}),(0,M.jsx)("span",{className:"text-xs font-medium text-gray-500",children:"Taux remboursement"})]}),(0,M.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[Y.repaymentRate,"%"]})]})]}),(0,M.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:[(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-5 shadow-lg border border-gray-100",children:[(0,M.jsx)("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Principal pr\xeat\xe9 (p\xe9riode)"}),(0,M.jsx)("p",{className:"text-xl font-bold text-green-700",children:(0,C.vv)(Y.principalValidatedInPeriod)})]}),(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-5 shadow-lg border border-gray-100",children:[(0,M.jsx)("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Paiements re\xe7us (p\xe9riode)"}),(0,M.jsx)("p",{className:"text-xl font-bold text-blue-600",children:(0,C.vv)(Y.totalPaidInPeriod)})]})]}),(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-4 sm:p-6 shadow-lg border border-gray-100 mb-6",children:[(0,M.jsxs)("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,M.jsx)(l.A,{size:20,className:"text-green-600"}),"Demandes de pr\xeats (p\xe9riode)"]}),(0,M.jsx)("div",{className:"h-64 sm:h-72",children:(0,M.jsx)(f.u,{width:"100%",height:"100%",children:(0,M.jsxs)(k.E,{data:Y.byDay,margin:{top:8,right:8,left:0,bottom:0},children:[(0,M.jsx)(v.d,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,M.jsx)(D.W,{dataKey:"label",tick:{fontSize:11},stroke:"#94a3b8"}),(0,M.jsx)(S.h,{tick:{fontSize:11},stroke:"#94a3b8",allowDecimals:!1}),(0,M.jsx)(b.m,{contentStyle:{borderRadius:"12px",border:"1px solid #e2e8f0"},formatter:e=>[e,"Demandes"],labelFormatter:e=>"Jour: ".concat(e)}),(0,M.jsx)(w.y,{dataKey:"demandes",fill:"#22c55e",radius:[6,6,0,0],name:"Demandes"})]})})})]}),(0,M.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-4 sm:p-6 shadow-lg border border-gray-100",children:[(0,M.jsxs)("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,M.jsx)(p.A,{size:20,className:"text-green-600"}),"Int\xe9r\xeats collect\xe9s (par mois)"]}),(0,M.jsx)("div",{className:"h-64",children:Y.interestByMonth.length>0?(0,M.jsx)(f.u,{width:"100%",height:"100%",children:(0,M.jsxs)(I.Q,{data:Y.interestByMonth,margin:{top:8,right:8,left:0,bottom:0},children:[(0,M.jsx)("defs",{children:(0,M.jsxs)("linearGradient",{id:"colorInterest",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,M.jsx)("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.4}),(0,M.jsx)("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:0})]})}),(0,M.jsx)(v.d,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,M.jsx)(D.W,{dataKey:"label",tick:{fontSize:10},stroke:"#94a3b8"}),(0,M.jsx)(S.h,{tick:{fontSize:10},stroke:"#94a3b8",tickFormatter:e=>"".concat(e/1e3,"k")}),(0,M.jsx)(b.m,{contentStyle:{borderRadius:"12px",border:"1px solid #e2e8f0"},formatter:e=>[(0,C.vv)(e),"Int\xe9r\xeats"]}),(0,M.jsx)(N.G,{type:"monotone",dataKey:"value",stroke:"#22c55e",strokeWidth:2,fill:"url(#colorInterest)",name:"Int\xe9r\xeats"})]})}):(0,M.jsx)("div",{className:"h-full flex items-center justify-center text-gray-400 text-sm",children:"Aucune donn\xe9e sur les int\xe9r\xeats par mois"})})]}),(0,M.jsxs)("div",{className:"bg-white rounded-2xl p-4 sm:p-6 shadow-lg border border-gray-100",children:[(0,M.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"R\xe9partition des pr\xeats"}),(0,M.jsx)("div",{className:"h-64 flex items-center justify-center",children:Y.byStatus.length>0?(0,M.jsx)(f.u,{width:"100%",height:"100%",children:(0,M.jsxs)(_.r,{children:[(0,M.jsx)(y.F,{data:Y.byStatus,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:2,dataKey:"value",nameKey:"name",label:e=>{let{name:t,value:a}=e;return"".concat(t,": ").concat(a)},children:Y.byStatus.map((e,t)=>(0,M.jsx)(j.f,{fill:e.color},e.name))}),(0,M.jsx)(b.m,{formatter:e=>[e,"Pr\xeats"],contentStyle:{borderRadius:"12px",border:"1px solid #e2e8f0"}}),(0,M.jsx)(h.s,{})]})}):(0,M.jsx)("p",{className:"text-gray-400 text-sm",children:"Aucun pr\xeat"})})]})]})]})})]})}}}]);
//# sourceMappingURL=407.93833a4c.chunk.js.map